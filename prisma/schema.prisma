generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String
  salt      String
  roleId    String?  @map("role_id")
  role      Role?    @relation(fields: [roleId], references: [id])
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  createdById   String? @map("created_by_id")
  created_by    User?   @relation("UserCreatedBy", fields: [createdById], references: [id])
  created_users User[]  @relation("UserCreatedBy")

  unit                 Unit[]
  unit_created         Unit[]     @relation("UnitCreatedBy")
  visi_misi_created    VisiMisi[] @relation("VisiMisiCreatedBy")
  PerformanceIndicator kpi[]      @relation("PerformanceIndicatorCreatedBy")
  MataAnggaran         ma[]       @relation("MataAnggaranCreatedBy")
  MaOnKpi              MaOnKpi[]  @relation("MaOnKpiCreatedBy")
  Bidang               Bidang[]   @relation("BidangCreatedBy")

  @@map("users")
}

model Bidang {
  id          String   @id @default(cuid())
  name        String
  code        String
  units       Unit[]
  kpi         kpi[]
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  createdById String?  @map("created_by_id")
  created_by  User?    @relation("BidangCreatedBy", fields: [createdById], references: [id])

  @@map("bidang")
}

model Role {
  id          String       @id @default(cuid())
  name        String       @unique
  permissions Permission[]
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  users       User[]

  @@map("roles")
}

model Permission {
  id          String  @id @default(cuid())
  name        String  @unique
  description String?
  roles       Role[]

  @@map("permissions")
}

model Unit {
  id          String        @id @default(cuid())
  name        String
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  createdById String?       @map("created_by_id")
  bidangId    String?
  isUnit      Boolean       @default(true) @map("is_unit")
  users       User[]
  VisiMisi    VisiMisi[]
  rekening    Rekening[]
  DataUnit    DataUnit[]
  DataSubUnit DataSubUnit[]

  created_by    User?   @relation("UnitCreatedBy", fields: [createdById], references: [id])
  Bidang        Bidang? @relation(fields: [bidangId], references: [id])
  primary_kpi   kpi[]   @relation("PrimaryPic")
  secondary_kpi kpi[]   @relation("SecondaryPic")

  @@map("units")
}

model DataUnit {
  id          String        @id @default(cuid())
  unitId      String        @map("unit_id")
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  DataSubUnit DataSubUnit[]

  unit Unit @relation(fields: [unitId], references: [id])

  @@map("data_unit")
}

model DataSubUnit {
  id         String   @id @default(cuid())
  unitId     String   @map("unit_id")
  dataUnitId String   @map("data_unit_id")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  unit     Unit     @relation(fields: [unitId], references: [id])
  dataUnit DataUnit @relation(fields: [dataUnitId], references: [id])

  @@map("data_sub_unit")
}

model VisiMisi {
  id         String  @id @default(cuid())
  unitId     String? @map("unit_id")
  tahun      String
  visi       String
  misi       String
  tujuan     String
  keterangan String

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  createdById String? @map("created_by_id")
  created_by  User?   @relation("VisiMisiCreatedBy", fields: [createdById], references: [id])

  unit Unit? @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@map("visi_misi")
}

model kpi {
  id               String    @id @default(cuid())
  bidangId         String    @map("bidang_id")
  kpiCode          String    @map("kpi_code")
  name             String
  sifat            String
  standard         String?
  baseline         String?
  target           String?
  year             String
  primary_pic_id   String    @map("primary_pic_id")
  secondary_pic_id String?   @map("secondary_pic_id")
  MaOnKpi          MaOnKpi[]
  ma               ma[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  createdById   String? @map("created_by_id")
  created_by    User?   @relation("PerformanceIndicatorCreatedBy", fields: [createdById], references: [id])
  primary_pic   Unit    @relation("PrimaryPic", fields: [primary_pic_id], references: [id])
  secondary_pic Unit?   @relation("SecondaryPic", fields: [secondary_pic_id], references: [id])
  bidang        Bidang? @relation(fields: [bidangId], references: [id])

  @@map("indikator_kinerja")
}

model ma {
  id          String    @id @default(cuid())
  maCode      String    @map("ma_code")
  name        String
  indicatorId String    @map("indicator_id")
  MaOnKpi     MaOnKpi[]
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  createdById String?   @map("created_by_id")
  created_by  User?     @relation("MataAnggaranCreatedBy", fields: [createdById], references: [id])
  indicator   kpi       @relation(fields: [indicatorId], references: [id])

  @@map("mata_anggaran")
}

model MaOnKpi {
  id          String      @id @default(cuid())
  kpiId       String      @map("kpi_id")
  maId        String      @map("ma_id")
  uraian      String
  output      String
  startDate   DateTime    @map("start_date")
  endDate     DateTime    @map("end_date")
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  createdById String?     @map("created_by_id")
  created_by  User?       @relation("MaOnKpiCreatedBy", fields: [createdById], references: [id])
  Pembelian   Pembelian[]

  KPI kpi @relation(fields: [kpiId], references: [id], onDelete: Cascade)
  MA  ma  @relation(fields: [maId], references: [id], onDelete: Cascade)

  @@map("_maonkpi")
}

model Rekening {
  id        String      @id @default(cuid())
  noRek     String      @map("no_rek")
  name      String
  jenisId   String      @map("jenis_id")
  units     Unit[]
  Pembelian Pembelian[]
  createdAt DateTime    @default(now()) @map("created_at")
  updatedAt DateTime    @updatedAt @map("updated_at")

  jenisRekening JenisRekening @relation(fields: [jenisId], references: [id])

  @@map("rekening")
}

model JenisRekening {
  id        String     @id @default(cuid())
  name      String
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")
  Rekening  Rekening[]

  @@map("jenis_rekening")
}

model Pembelian {
  id         String   @id @default(cuid())
  rekeningId String   @map("rekening_id")
  prokerId   String   @map("proker_id")
  uraian     String
  satuan     String
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  rekening        Rekening @relation(fields: [rekeningId], references: [id])
  ma_to_indicator MaOnKpi  @relation(fields: [prokerId], references: [id])

  @@map("pembelian")
}
